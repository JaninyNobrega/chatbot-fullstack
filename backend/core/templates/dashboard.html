{% extends "admin/base_site.html" %}

{% block content %}

<h1 style="margin-bottom:20px;">ğŸ“Š Dashboard do Sistema</h1>

<div style="display:flex; gap:20px; flex-wrap:wrap;">

    <div style="background:white; padding:20px; border-radius:12px; width:250px; box-shadow:0 0 10px #ddd;">
        <h3>Total de Mensagens</h3>
        <p style="font-size:28px; font-weight:bold;">{{ total_messages }}</p>
    </div>

    <div style="background:white; padding:20px; border-radius:12px; width:250px; box-shadow:0 0 10px #ddd;">
        <h3>UsuÃ¡rios Ativos</h3>
        <p style="font-size:28px; font-weight:bold;">{{ total_users }}</p>
    </div>

    <div style="background:white; padding:20px; border-radius:12px; width:250px; box-shadow:0 0 10px #ddd;">
        <h3>Ãšltimas 24h</h3>
        <p style="font-size:28px; font-weight:bold;">{{ messages_24h }}</p>
    </div>
</div>


<h2 style="margin-top:40px;">ğŸ“… Mensagens nos Ãºltimos 7 dias</h2>
<canvas id="chartDays" width="600" height="200"></canvas>

<h2 style="margin-top:40px;">ğŸ‘¤ Mensagens por usuÃ¡rio</h2>
<canvas id="chartUsers" width="600" height="200"></canvas>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const daysLabels = {{ messages_by_day|json_script:"days" }};
const userLabels = {{ messages_by_user|json_script:"users" }};

const ctx1 = document.getElementById('chartDays').getContext('2d');
new Chart(ctx1, {
    type: 'line',
    data: {
        labels: daysLabels.map(x => x.day),
        datasets: [{
            label: 'Mensagens',
            data: daysLabels.map(x => x.total),
            borderWidth: 2,
        }]
    }
});

const ctx2 = document.getElementById('chartUsers').getContext('2d');
new Chart(ctx2, {
    type: 'bar',
    data: {
        labels: userLabels.map(x => x.user),
        datasets: [{
            label: 'Mensagens',
            data: userLabels.map(x => x.total),
            borderWidth: 2,
        }]
    }
});
</script>

{% endblock %}
